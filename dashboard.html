/* 
        SETUP REQUIRED:
        
        1. Replace the following client IDs with your actual app credentials:
           - your_twitch_client_id
           - your_youtube_client_id  
           - your_instagram_client_id
           - your_tiktok_client_id
        
        2. Create OAuth apps for each platform:
           - Twitch: https://dev.twitch.tv/console/apps
           - YouTube: https://console.developers.google.com/
           - Instagram: https://developers.facebook.com/apps/
           - TikTok: https://developers.tiktok.com/
        
        3. Set up redirect URIs for each platform:
           - https://autostreampro.com/auth/twitch
           - https://autostreampro.com/auth/youtube
           - https://autostreampro.com/auth/instagram
           - https://autostreampro.com/auth/tiktok
        
        4. Create backend endpoints to handle OAuth token exchange:
           - /api/auth/callback (for exchanging codes for tokens)
        
        5. Set up database table 'platform_connections' with columns:
           - user_id, platform_name, access_token, refresh_token, 
           - platform_user_id, status, connected_at
        */
        window.connectTwitch = async function() {
            const button = document.querySelector('[onclick="connectTwitch()"]');
            const originalText = button.innerHTML;
            
            try {
                button.innerHTML = '<div class="loading-spinner"></div> Connecting...';
                button.disabled = true;
                
                // Twitch OAuth URL
                const twitchClientId = 'your_twitch_client_id'; // Replace with actual client ID
                const redirectUri = encodeURIComponent(window.location.origin + '/auth/twitch');
                const scope = encodeURIComponent('user:read:email channel:read:stream_key');
                const state = Math.random().toString(36).substring(7);
                
                // Store state for verification
                sessionStorage.setItem('twitch_state', state);
                
                const twitchAuthUrl = `https://id.twitch.tv/oauth2/authorize?client_id=${twitchClientId}&redirect_uri=${redirectUri}&response_type=code&scope=${scope}&state=${state}`;
                
                // Open in popup or redirect
                const popup = window.open(twitchAuthUrl, 'twitchAuth', 'width=600,height=700');
                
                // Listen for popup completion
                const checkClosed = setInterval(() => {
                    if (popup.closed) {
                        clearInterval(checkClosed);
                        button.innerHTML = originalText;
                        button.disabled = false;
                        checkConnectionStatus();
                    }
                }, 1000);
                
            } catch (error) {
                console.error('Twitch connection error:', error);
                showToast('Failed to connect to Twitch', 'error');
                button.innerHTML = originalText;
                button.disabled = false;
            }
        };
        
        window.connectYouTube = async function() {
            const button = document.querySelector('[onclick="connectYouTube()"]');
            const originalText = button.innerHTML;
            
            try {
                button.innerHTML = '<div class="loading-spinner"></div> Connecting...';
                button.disabled = true;
                
                // YouTube OAuth URL
                const youtubeClientId = 'your_youtube_client_id'; // Replace with actual client ID
                const redirectUri = encodeURIComponent(window.location.origin + '/auth/youtube');
                const scope = encodeURIComponent('https://www.googleapis.com/auth/youtube.readonly https://www.googleapis.com/auth/youtube.upload');
                const state = Math.random().toString(36).substring(7);
                
                sessionStorage.setItem('youtube_state', state);
                
                const youtubeAuthUrl = `https://accounts.google.com/oauth/authorize?client_id=${youtubeClientId}&redirect_uri=${redirectUri}&response_type=code&scope=${scope}&access_type=offline&state=${state}`;
                
                const popup = window.open(youtubeAuthUrl, 'youtubeAuth', 'width=600,height=700');
                
                const checkClosed = setInterval(() => {
                    if (popup.closed) {
                        clearInterval(checkClosed);
                        button.innerHTML = originalText;
                        button.disabled = false;
                        checkConnectionStatus();
                    }
                }, 1000);
                
            } catch (error) {
                console.error('YouTube connection error:', error);
                showToast('Failed to connect to YouTube', 'error');
                button.innerHTML = originalText;
                button.disabled = false;
            }
        };
        
        window.connectInstagram = async function() {
            const button = document.querySelector('[onclick="connectInstagram()"]');
            const originalText = button.innerHTML;
            
            try {
                button.innerHTML = '<div class="loading-spinner"></div> Connecting...';
                button.disabled = true;
                
                // Instagram OAuth URL (Facebook App)
                const instagramClientId = 'your_instagram_client_id'; // Replace with actual client ID
                const redirectUri = encodeURIComponent(window.location.origin + '/auth/instagram');
                const scope = encodeURIComponent('user_profile,user_media');
                const state = Math.random().toString(36).substring(7);
                
                sessionStorage.setItem('instagram_state', state);
                
                const instagramAuthUrl = `https://api.instagram.com/oauth/authorize?client_id=${instagramClientId}&redirect_uri=${redirectUri}&scope=${scope}&response_type=code&state=${state}`;
                
                const popup = window.open(instagramAuthUrl, 'instagramAuth', 'width=600,height=700');
                
                const checkClosed = setInterval(() => {
                    if (popup.closed) {
                        clearInterval(checkClosed);
                        button.innerHTML = originalText;
                        button.disabled = false;
                        checkConnectionStatus();
                    }
                }, 1000);
                
            } catch (error) {
                console.error('Instagram connection error:', error);
                showToast('Failed to connect to Instagram', 'error');
                button.innerHTML = originalText;
                button.disabled = false;
            }
        };
        
        window.connectTikTok = async function() {
            const button = document.querySelector('[onclick="connectTikTok()"]');
            const originalText = button.innerHTML;
            
            try {
                button.innerHTML = '<div class="loading-spinner"></div> Connecting...';
                button.disabled = true;
                
                // TikTok OAuth URL
                const tiktokClientId = 'your_tiktok_client_id'; // Replace with actual client ID
                const redirectUri = encodeURIComponent(window.location.origin + '/auth/tiktok');
                const scope = encodeURIComponent('user.info.basic,video.list');
                const state = Math.random().toString(36).substring(7);
                
                sessionStorage.setItem('tiktok_state', state);
                
                const tiktokAuthUrl = `https://www.tiktok.com/auth/authorize/?client_key=${tiktokClientId}&response_type=code&scope=${scope}&redirect_uri=${redirectUri}&state=${state}`;
                
                const popup = window.open(tiktokAuthUrl, 'tiktokAuth', 'width=600,height=700');
                
                const checkClosed = setInterval(() => {
                    if (popup.closed) {
                        clearInterval(checkClosed);
                        button.innerHTML = originalText;
                        button.disabled = false;
                        checkConnectionStatus();
                    }
                }, 1000);
                
            } catch (error) {
                console.error('TikTok connection error:', error);
                showToast('Failed to connect to TikTok', 'error');
                button.innerHTML = originalText;
                button.disabled = false;
            }
        };
